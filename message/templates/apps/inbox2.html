<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+yUplP5E6D5hbk8DYfJ3e6M5ow5yXyU7E" crossorigin="anonymous"></script>

<!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome (for icons) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <style>
    body {
      margin: 0;
      padding: 0;
    }
    .navbar {
      margin: 0;
      padding: 0;
    }
    i {
      font-size: 1.5rem; /* Adjust icon size */
      color: #333; /* Adjust icon color */
    }
    .navbar {
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* Soft shadow */
  }

  </style>

</head>
<body>

<head>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

	<style>
		body{margin-top:20px;}

.chat-online {
    color: #34ce57
}

.chat-offline {
    color: #e4606d
}

.chat-messages {
    display: flex;
    flex-direction: column;
    max-height: 800px;
    overflow-y: scroll
}

.chat-message-left,
.chat-message-right {
    display: flex;
    flex-shrink: 0
}

.chat-message-left {
    margin-right: auto
}

.chat-message-right {
    flex-direction: row-reverse;
    margin-left: auto
}
.py-3 {
    padding-top: 1rem!important;
    padding-bottom: 1rem!important;
}
.px-4 {
    padding-right: 1.5rem!important;
    padding-left: 1.5rem!important;
}
.flex-grow-0 {
    flex-grow: 0!important;
}
.border-top {
    border-top: 1px solid #dee2e6!important;
}
	</style>
</head>
<br><br>

<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container-fluid">
        <!-- Navbar Start -->
        <a class="navbar-brand fw-bold text-danger" href="#">TakePetDate</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <!-- Navbar Center -->
            <ul class="navbar-nav mx-auto">
                <li class="nav-item">
                    {% if user.is_authenticated %}
                        <a class="nav-link" href="{% url 'find_match' %}">Find Match</a>
                    {% else %}
                        <a class="nav-link" href="{% url 'signin' %}">Find Match</a>
                    {% endif %}
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'message' %}">Message</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'nearby_pets' %}">Find Nearby</a>
                </li>
            </ul>
        </div>

        <!-- Navbar End -->
        <div class="d-flex gap-3 align-items-center">
            <!-- Notification -->
            <a href="{% url 'notification' %}" class="btn btn-light position-relative">
                <i class="fa-solid fa-bell me-3"></i>
                <span class="position-absolute top-1 start-100 translate-middle badge rounded-pill bg-danger">
                    1
                </span>
            </a>

            <!-- User Dropdown -->
            <div class="dropdown">
                <a href="#" class="btn btn-light dropdown-toggle" id="userDropdown" role="button"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="{% if request.user.is_authenticated and request.user.foto and request.user.foto.url %}/media/{{ request.user.foto }}{% else %}https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQBkA9WO3FnL4fddebhCcTztCr6vr2METdo9w&s{% endif %}" 
                        alt="Profile" class="rounded-circle" width="30" height="30">
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
                    {% if request.user.is_authenticated %}
                        <li><a class="dropdown-item" href="{% url 'logout' %}">Log Out</a></li>
                    {% else %}
                        <li><a class="dropdown-item" href="{% url 'signup' %}">Sign Up</a></li>
                        <li><a class="dropdown-item" href="{% url 'signin' %}">Sign In</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</nav>


<main class="conetent">
    <div class="container p-0">

		<h1 class="h3 mb-3">Messages</h1>

		<div class="card my-3">
			<div class="row g-0">
				<div class="col-12 col-lg-12 col-xl-3 border-right chat-messages" >

          <div class="m-3">
					<form method="get" action="{% url 'message' %}">
						<input type="text" name="q" class="form-control" placeholder="Search users...">
						<button type="submit" class="btn btn-danger mt-2">Search</button>
					</form>
          </div>
					
					{% if search_results %}
						<div class="m-3">
							<h5>Search Results:</h5>
							{% for user in search_results %}
								<a href="{% url 'directs' user.username %}" class="list-group-item list-group-item-action border-0 bg-light mt-2">
									<div class="d-flex align-items-start">
										<img src="/media/{{ user.foto }}" class="rounded-circle mr-1" alt="img" width="40" height="40">
										<div class="flex-grow-1 my-1 px-2">
                      <h5>
											  <strong>{{ user.username }}</strong>
                      </h5>
										</div>
									</div>
								</a>
							{% endfor %}
						</div>
					{% endif %}
					
					{% for message in messages %}
					<a href="{% url 'directs' message.user.username %}" class="list-group-item list-group-item-action border-0 {% if active_direct == message.user.username %}active{% endif %}" style="background-color:#F1AEB5;">
						<div class="badge  float-right" style="background-color:#B02A37;"></div>
						<div class="d-flex align-items-start pb-2">
							
								<img src="/media/{{ message.user.foto }}" class="rounded-circle mr-1" alt="img" width="40" height="40">
							
							<div class="flex-grow-1 ml-6">
								<b>{{message.user.profile.first_name}} {{message.user.profile.last_name}}</b>
								<div class="small my-1 px-2">
                  <h5>
                  @{{message.user.username}}
                </h5></div>
							</div>
						</div>
					</a>
					{% endfor %}

					<hr class="d-block d-lg-none mt-1 mb-0">
				</div>
				<div class="col-12 col-lg-7 col-xl-9">
					<div class="py-2 px-4 border-bottom d-none d-lg-block">
						<div class="d-flex align-items-center py-1">
							<!-- <div class="position-relative">
								<img src="https://bootdey.com/img/Content/avatar/avatar3.png" class="rounded-circle mr-1" alt="Sharon Lessman" width="40" height="40">
							</div>
							<div class="flex-grow-1 pl-3">
								<strong>Sharon Lessman</strong>
								<div class="text-muted small"><em>Typing...</em></div>
							</div> -->
							<div>
								<button class="btn btn-danger btn-lg mr-1 px-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone feather-lg"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg></button>

								<button class="btn btn-lg mr-1 px-3 d-none d-md-inline-block" style="background-color:#EA868F;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-video feather-lg"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg></button>
								<button class="btn btn-light border btn-lg px-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal feather-lg"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></button>
							</div>
						</div>
					</div>

					<div class="position-relative">
						<div class="chat-messages p-4">

									{% for direct in directs %}
										{% if direct.sender == request.user %}
											<div class="chat-message-right pb-2">
												<div>
													<a href=""><img src="/media/{{ direct.sender.foto }}" class="rounded-circle mr-1" alt="img" width="40" height="40"></a>
													<div class="text-muted small text-nowrap mt-2" style="font-size:10px; color: rgba(180, 180, 180, 0);"><p style="font-size:10px; color: black;">{{direct.date|date:"d M, Y"}}</p></div>

												</div>
												<div class="flex-shrink-1 bg-light rounded py-2 px-3 ml-3">
													<!-- <div class="font-weight-bold mb-1">Sharon Lessman</div> -->
													{{direct.body}}
												</div>
											</div>
										{% else %}
											<div class="chat-message-left pb-2">
												<div>
													<a href=""><img src="/media/{{ direct.sender.foto }}" class="rounded-circle mr-1" alt="img" width="40" height="40"></a>
													<div class="text-muted small text-nowrap mt-2" style="font-size:10px; color: rgba(180, 180, 180, 0);"><p style="font-size:10px; color: black;">{{direct.date|date:"d M, Y"}}</p></div>

												</div>
												<div class="flex-shrink-1 bg-light rounded py-2 px-3 ml-3">
													<!-- <div class="font-weight-bold mb-1">Sharon Lessman</div> -->
													{{direct.body}}
												</div>
											</div>
										{% endif %}
									{% endfor %}
							

						</div>
					</div>

						<div class="flex-grow-0 py-3 px-4 border-top">
							<form method="POST" action="{% url 'send-directs' %}">
								{% csrf_token %}
								<div class="input-group">
									<input type="hidden" name="to_user" id="" value="{{active_direct}}">
									<input name="body" type="text" class="form-control" placeholder="Type your message">
									<button class="btn btn-danger" type="submit">Send</button>
								</div>
							</form>
							
						</div>

				</div>
			</div>
		</div>
	</div>
</main>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</html>
</body>
</html>